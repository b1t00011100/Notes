# Incident Response & Forensics

### Incident Response Procedures

- Our systems will never be 100% secure.
- **Incident Response :** A set of procedures that an investigator does when examining a computer security incident.
- **Incident Management Program :** Program consisting of the monitoring and detection of security events on a computer network and the execution of proper responses to those security events.
- Basic Six Step Incident response procedure
    1. **Preparation :** Making plans beforehand on the response.
    2. **Identification :** Process of recognizing whether an event that occurs should be classified as an incident.
    3. **Containment :** Containment is focused on isolating the incident.
    4. **Eradication :** Remove the threat or Attack.
    5. **Recovery :** Focused on data restoration, system-repair, and re-enabling any servers or networks taken offline during the incident response.
    6. **Lessons Learned :** Reporting about the whole incident.

### Incident Response Planning

- **Incident Response Team :** Key people that are available to respond to any incident that meets the severity and priority thresholds set out by the incident response plan.
- Incident Response Team Roles
    - **Incident Response Manager :** Oversee and Prioritize actions during the detection, analysis and containment of an incident.
    - **Security Analysts :** Works directly on the affected network and investigate the incidence.
        - **Triage Analyst :** Analysts assigned to work on the network during the incident response.
        - **Forensic Analyst :** Focused on the detective work and Try to work out the already happened.
    - **Threat Researcher :** Complements the analyst by providing threat intelligence and overall context during your incident response.
    - **Cross Functional Support :** Theses includes people from management or the executive team, Somebody from HR is dealing with insider threat, or an lawyer and attorney in case there is legal action.
- This Incident Response Team is often known as **CSIRT (Computer Security Incident Response Team)**.
- CISRT should be the single point of contact for security incidents and may be a part of the SOC or an independent team.
- The team must have a secure method of communication for managing incidents.
- Maintain an up-to-date contact list.
- Affected Stakeholders
    - **Senior Leadership :** Executives and managers who are responsible for business operations and functional areas.
    - **Regulatory Bodies :** Government organizations that oversee the compliance with specific regulations and laws.
    - **Legal :** The Business or Organizations Legal Counsel in responsible for mitigating risk from civil lawsuits.
    - **Law Enforcement :** May provide services to assist in your incident handling efforts or to prepare for legal actions against the attacker in the future.
        - The decision to involve law enforcement must be made by senior executive with guidance from legal.
    - **Human Resources (HR) :** Used to ensure no breaches of employment law or employee contracts is made during an incident response.
    - **Public Relations (PR) :** Used to manage negative publicity from a serious incident.
- **CSIRT** will be asked for information regarding the estimated downtime, the scope of systems and data affected, and other relevant details.

### Investigative Data

- **`Security Information and Event Monitoring (SIEM)`:** A combination of different data sources into one tool that provides real-time analysis of security alerts generated by applications and network hardware. ****
- **`Log File` :** A file that records either events that occur in an operating system or other software that runs or messages between different users of communication software.
- **`syslog/ rsyslog / syslog-ng` :** Three variations of syslog permit the logging of data from different types of systems in a central repository.
- **`Journalctl` :** A Linux command-line utility used for querying and displaying logs from *journald*, the *systemd* logging service on Linux.
- **`nxlog` :** A multi-platform log management tool that helps to easily identify security risks, policy breaches or analyze operational problems in server logs, operation system logs and application logs.
    - *nxlog* is a cross-platform, open-source tool that is similar to *rsyslog* or *syslog-ng*.
    
    <aside>
    üí° Difference : *rsyslog/syslog-ng* & *nxlog* :
    
    - rsyslog and syslog-ng  - Linux and Unix.
    - nxlog - Unix, Linux and Windows. (as cross-platform)
    </aside>
    
- `netflow` : A network protocol system created by Cisco that collects active IP network traffic as it flows on or out of an interface, including its point or origin, destination, volume and paths on the network.
- `sflow` : Short for ‚Äú**Sampled flow‚Äù** , it provides a means for exporting truncated packets together with interface counters for the purpose of network monitoring.
- `Internet Protocol Flow Information Export (IPfix)` : A universal standard of export for Internet Protocol flow information from routers, probes and other devices that are used by mediation systems, accounting/billing systems and network management systems to facilitate services such as measurement, accounting and billing by defining how IP flow information is to be formatted and transferred from an exporter to a collector.
- `Metadata` : Data that describes other data by providing an underlying definition or description by summarizing basic information about data that makes finding and working with particular instances of data easier.

### Forensic Procedures

- Written procedures ensure that personnel handle forensics properly, effectively, and in compliance with required regulations.
- 4 main topics in **Forensics Procedures**
    - **Identification :** Ensure the scene is safe, secure the scene to prevent evidence contamination, and identify the scope of evidence to be collected.
    - **Collection :** Ensure authorization to collect evidence is obtained and prove the integrity of evidence as it is collected.
    - **Analysis :** Create a copy of evidence for analysis and use repeatable methods and tools during analysis.
    - **Reporting :** Create a report of the methods and tools used in the investigation and present detailed findings and conclusions based on the analysis.
- **Legal Hold :** A process designed to preserve all relevant information when litigation is reasonably expected to occur.
    - A computer or server could be seized as evidence.
- Appoint a liaison with legal knowledge and expertise who can be the point of contact with law enforcement.
- **Code of Ethics**
    - Analysis must be performed without bias.
    - Analysis methods must be repeatable by third parties.
    - Evidence must not be changed or manipulated.
- **Timeline :** A tool that shows the sequence of file system events within a source image in a graphical format.
- Many forensics tools can generate a timeline based on your evidence.
- if tool doesn‚Äôt support it, you can create a sequence of events within a spreadsheet to serve as a timeline.

### Data Collection Procedures

- Create a forensics disk image of the data as evidence.
- Data and Evidence Collection procedures
    - *Capture and hash system images*
    - *Analyze data with tools*
    - *Capture Screenshots*
    - *Review network traffic and logs*
    - *Capture Video*
    - *Capture order of volatility*
    - *Take Statements*
    - *Review licensing and documentation*
    - *Track man-hours and expenses*
- FTK and Encase are the commonly used forensic tools
- **Data Acquisition :** The method and tools used to create a forensically sound copy of data from a source device, such as system memory or a hard disk. ****
- Bring-your-own-device (BYOD) policies complicate *data acquisition* since you may not be able to legally search or seize the device.
- Some data can only be collected once the system is shutdown or the power suddenly disconnected.
- Analysts should always follow the order of volatility when collecting evidence.
    1. CPU registers and cache memory.
    2. RAM, routing tables, ARP cache, process table, temporary swap files.
    3. Data on persistent mass storage *(HDD/SSD/Flash drive).
    4. Remote logging and monitoring data.
    5. Physical configurations and monitoring data.
    6. Archival media.

### Security Tools

- **Networking Tools**
    - `tracert/traceroute` : A network diagnostic command for displaying possible routes and measuring transit delay of packets across an Internal Protocol network.
    - `nslookup/dig` : Utility used to determine the IP address associated with a domain name, obtain the mail server settings for a domain, and other DNS information.
    - `ipconfig/ifconfig` : Utility that displays all the network configurations of the currently connected network devices and can modify the DHCP and DNS settings.
    - `nmap` : An open-source network scanner that is used to discover hosts and services on a computer network by sending packets and analyzing their responses.
    - `ping/pathping` : Utility used to determine if a host is reachable on a Internet Protocol Network.
    - `hping` : An open-source packet generator and analyzer for the TCP/IP protocol that is used for security auditing and testing of firewalls and networks.
    - `netstat` : Utility that displays network connections for TCP, routing tables, and a number of network interface and network protocol statistics.
    - `netcat` : Utility for reading from and writing to network connections using TCP or UDP which is a dependable back-end that can be used directly or easily driven by other programs and scripts.
    - `arp` : Utility for viewing and modifying the local Address Resolution Protocol (ARP) cache on a given host or server.
    - `route` : Utility that is used to view and manipulate the IP routing table on a host or server.
    - `curl` : A command line tool to transfer data to or from a server, using any of the supported protocols -(HTTP,FTP,IMAP,POP3,SCP,SFTP,SMTP,TFTP,TELNET,LDAP or FILE).
    - `the harvester` : A python script that is used to gather emails, subdomains, hosts, employee names, open ports and banners from different public sources like search engines, PGP key servers and SHODAN database.
    - `sn1per` : An automated scanner that can be used during a penetration test to enumerate and scan for vulnerabilities across a network.
    - `scanless` : Utility that is used to create an exploitation website that can perform Open port scans in a more stealth-like manner.
    - `dnsenum` :Utility that is used for DNS enumeration to locate all DNS servers and DNS entries for a given entries.
    - `Nessus` : A proprietary vulnerability scanner that can remotely scan a computer or network for vulnerabilities.
    - `Cuckoo` : An open source software for automating analysis of suspicious files.
- **File Manipulation Tools**
    - `head` : A command-line utility for outputting the first ten lines of a file provided to it.
    - `tail` : A command-line utility for outputting the last ten lines of a file provided to it.
    - `cat (concatenate)` : A command-line utility for outputting the contents of a file to the screen.
    - `grep` : A command-line utility for searching plain-text data sets for lines that match a regular expression or pattern.
    - `chmod`: A command-line utility used to change the access permissions of file system objects.
    - `logger` : Utility that provides an easy way to add messages to the */var/log/syslog* file from the command line or from other files.
- **Shell and Scripts**
    - `SSH`: Utility that supports encrypted data transfer between two computers for secure logins, file transfers, or general purpose connections.
    - `Powershell` : A task automation and configuration management framework from Microsoft, consisting of a command-line shell and the associated scripting language.
    - `Python` : An interpreted, high-level and general-purpose programming language.
    - `OpenSSL` : A software library for applications that secure communications over computer networks against eavesdropping or need to identify the party at the other end.
- **Packet Capture**
    - `tcpdump` :  A command-line utility that allows you to capture and analyze network traffic going through your system.
    - `tcpreplay` : A suite of free open source utilities for editing and replaying previously captured network traffic.
    - `Wireshark` : A popular network analysis tool to capture network packets and display them at a granular level for real-time or offline analysis.
- **Forensics Tools**
    - `dd` : A command-line utility used to copy disk images using a bit by bit copying process.
    - `FTK Imager` : A data preview and imaging tool that lets you quickly assess electronic evidence to determine if further analysis with a forensic tool is needed.
    - `Memdump` : A command-line utility used to dump system memory to the standard output system by skipping over holes in memory gaps.
    - `WinHex` : A commercial disk editor and universal hexadecimal editor used for data recovery and digital forensics.
    - `Autopsy` : A digital forensics platform and graphical interface to The Sleuth Kit and other digital forensics tool.
- **Exploitation Tools**
    - `Metasploit (MSF)`: A computer security tool that offers information about software vulnerabilities, IDS signature development, and improves penetration testing.
    - `Browser Exploitation Framework (BeEF)` : A tool that can hook or more browsers and can use them as a beachhead of launching various direct commands and further attacks against the system from within the browser context.
    - `Cain and Abel` : A password recovery tool that can be used through sniffing the network, cracking encrypted passwords using dictionary, brute-force and cryptanalysis attacks, recording VoIP conversations, decoding scrambled passwords, revealing passwords boxes and analyzing routing protocols.
    - `Jack The Ripper` : An open source password security auditing and password recovery tool available for many operating systems.