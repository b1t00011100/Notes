# Monitoring and Auditing

### Monitoring types

- **Signature-based :** Network traffic is analyzed for predetermined attack patterns.
- **Anomaly-based :** A baseline is established and any network traffic that is outside of the baseline is evaluated.
- **Behavior-based :** Activity is evaluated based on the previous behavior of applications, executables and the operating system in comparison to the current activity of the system. ****
- Methods maybe combined into a hybrid approach in some IDS/IPS systems.

### Performance Baselining

- **Baselining** : Process of measuring changes in networking, hardware, software and applications.
- **Baselining Reporting** : Documenting and reporting on the changes in a baseline.
- **Security Posture** : Risk level to which a system or other technology element is exposed.

### Protocol Analyzer

- **Protocol Analyzer** are used to capture and analyze network traffic.
    - **Promiscuous Mode** : Network adapter is able to capture all of the packets on the network regardless of the destination MAC address of the frames carrying them.
    - **Non-promiscuous Mode** : Network adapter can only capture the packets addressed to itself directly.
- To capture the most information, you need to be in promiscuous mode.
- **Port Mirroring** : One or more switch ports are configured to forward all of their packets to another port on the switch.
- **Network Tap** : A physical device that allows you to intercept the traffic between two points on the network.

### SNMP

- **Simple Network Management Protocol (SNMP)** : A TCP./IP protocol that aids in monitoring network-attached devices and computers.
- This protocol is broken down into three components
    - **Managed Devices :** Computers and other network-attached devices monitored through the use of agents by a network management system.
    - **Agent :** Software that is loaded on a managed device to redirect information to the network management system.
    - **Network Management Systems :** Software run on one or more servers to control the monitoring of network-attached devices and computers.
- **SNMP** through Security viewpoint :
    - **SNMP v1**
    - **SNMP v2**
    - **SNMP v3**
- SNMP v1/v2 are insecure due to the use of community strings to access a device.
- **SNMP v3** : Version of SNMP that provides integrity, authentication and encryption of the messages being sent over the network.
- Management should be conducted on an out-of-band network to increase security, as in-band network is insecure.

### Auditing

- **Auditing** : A technical assessment conducted on applications, systems, or networks.
    - Auditing is a detective control.
- **Auditing** can be done manually or using tools.
    - **Manual Auditing**
        - *Security Logs*
        - *ACLs*
        - *User rights/permissions*
        - *Group Policies(GPOs)*
        - *Vulnerability scans*
        - *Written organizational policies*
        - *interviewing personnel*
- Ideal Auditing can be done by combining Manual Audit and tools.

### Logging

- **Logs** : Data files that contain the accounting and audit trail for actions performed by a user on the computer or network.
- Security, System and Application logs should be audited on a Windows systems.
    - **Security Logs** : Logs that events such as successful and unsuccessful user logons to the system.
    - **System Logs** : Logs the events such as a system shutdown and driver failures.
    - **Application Logs** : Logs the events for the operating system and third-party applications.
- To consolidate all the logs into a single repository, you can use **SYSLOG**.
    - **SYSLOG :** A standardized format used for computer message logging that allows for the separation of the software that generates messages, the system that stores them and the software that reports and analyzes them.
    - SYSLOG uses port 514 over UDP.

### Log Files

- **Log files** are important to your ability to reconstruct an event after it occurs.
- **Log File Maintenance** : Actions taken to ensure the proper creation and storage of a log file, such as the proper configuration, saving, backing up, securing and encrypting of the log files.
- Log files should be saved to a different partition or an external server.
- **Overwrite Events** : When a maximum log size is reached, the system can begin overwriting the oldest events in the log files to make room.
- **Log files** should be archived and backed up to ensure they are available when required.
- **Write Once Read Many (WORM)** : Technology like a DVD-R that allows dat to be written only once but read unlimited times.

### SIEM

- **Security Information and Event Management System (SIEM) :** A solution that provides real-time or near-real-time analysis of security alerts generated by network hardware and applications.
- *SIEM solutions* can be implemented as software, hardware appliances or outsourced managed services.
- SIEM solutions which are commercially available
    - **Splunk :** A market-leading big data information gathering and analysis tool that can import machine-generated data via a connector or visibility add-on.
        - *Splunk* may be installed locally or as a cloud-based solution.
    - **ELK/Elastic Stack :** Collection of free and open-source SIEM tools that provide storage, search and analysis functions.
        - It is made up of 4 components
        1. Elasticsearch (query/analytics)
        2. Logstash (log collection/normalization)
        3. Kibana (visualization)
        4. Beats (endpoint collection agents)
    - **ArcSight :** A SIEM log management and analytics software that can be used for compliance reporting for legislation and regulations like HIPPA, SOX and PCI DSS.
    - **QRadar :** A SIEM log management, analytics, and compliance reporting platform created by IBM.
    - **Alien Vault and OSSIM :** A SIEM solution originally developed by Alien Vault, now owned by AT&T, and rebranded as AT&T Cybersecurity.
    - **Graylog :** An open-source SIEM with an enterprise version focused on compliance and supporting IT operations and DevOps.

### Syslog

- **Syslog** : A protocol enabling different appliances and software applications to transmit logs or event records to a central server.
- Syslog follows a client-server model and is the de facto standard for logging of events from distributed systems.
- A *syslog message* contains a PRI (Priority) code, a header and a message portion.
    - A PRI code is calculated from the facility and severity level of the data.
    - A header contains the timestamp of the event and the hostname.
    - The message portion contains the source process of the event and related content.
- Since syslog relied on UDP, there can be delivery issue within congested networks.
- Basic security controls like encryption and authentication are not included by default within syslog.
- Due to these security issues, newer syslog implementations added new features and capabilities.
    - Newer implementations can use port 1468(TCP) for consistent delivery.
    - Newer implementations can use TLS to encrypt messages sent to servers.
    - Newer implementations can use MD-5 or SHA-1 for authentication and integrity.
    - Some newer implementations can use message filtering, automated log analysis, event response scripting, and alternate message formats.
- The newer version of the server is called **syslog-ng** or **rsyslog.**
- Syslog can refer to the protocol, the server or the log entries themselves.

### SOAR

- **Security Orchestration, Automation and Response (SOAR)** : A class of security tools that facilitates incident response, threat hunting and security configurations by orchestrating automated runbooks and delivering data enrichment.
- SOAR is primarily used for incident response.
- SOAR = SIEM 2.0
- **Playbook** : A checklist of actions to perform to detect and respond to a specific type of incident.
- **Runbook** : An automated version of a playbook that leaves clearly defined interaction point for human analysis.